---
layout: "base.njk"
title: Polytfil 공급망 공격
date: 2024-07-17
---

2024년 2월 Polyfill 공급망 공격(Polyfill Supply Chain Attack)이라고 불리는 수십만개가 넘는 웹사이트가 공격을 받은 사건이 있었습니다.
흔히 오래된 브라우저의 호환성을 위해 자주 사용되던 Polyfill 자바스크립트 라이브러리에 악성 코드가 삽입되어 있었던 사건입니다.
이 악성 코드는 웹사이트 방문자들에게 불법 도박 사이트, 성인사이트 등 악성 사이트로 리다이렉트 시키는 코드가 심어져 있었습니다.
이 악성 코드가 심어져있던 Polyfill 자바스크립트 라이브러니는 WarnerBros, Hulu, Mercedes-Benz와 같이 대형 기업의 웹사이트에서도 사용되는 하위 호환성을 맞기위한 아주 유명한 라이브러리 입니다.
그래서 이 공격으로 인해 이런 대형회사들도 같은 피해를 받았습니다.

## 어떻게 공격이 이루어졌나요?
Polyfill 공급망 공격은 중국의 한 회사인 Funnull에 의해 이루어졌습니다. 
이 회사는 Polyfill CDN 서비스를 제공하고 있는 도메인을 구매하고, 또 이것에 연관이 있는 Github 저장소도 인수했습니다.
그리고 Polyfill 라이브러리에 악성 코드를 삽입한 다음 Polyfill CDN을 통해서 Polyfill 라이브러리를 Embedding 하고 있는 수십만개의 웹사이트에 악성 코드가 삽입된 Polyfill 라이브러리를 배포했습니다.

이 회사는 치밀하게도 Polyfill 라이브러리를 Embedding 하고 있는 웹사이트에 사용자들이 들어오면 악성 사이트로 리다이렉트를 시키는데, 
이 회사는 치밀하게도 하루에 특정 시간에만 리다이렉트, 웹 분석툴이 적용된 웹사이트나, 관리자 로그인이 되어있을 때는 작동안되게끔, 모바일으로 접속했을 때만 리다이렉트 시키게끔,
아주 치밀한 악성코드를 삽입해서 웹사이트 관리자가 쉽게 발견하기 어렵게 만들었습니다.

`cdn.polyfill.io` 외 에도 `bootcdn.net`, `bootcss.com`, `staticfile.net`, `staticfile.org`,  `unionadjs.com`, `xhsbpza.com`, `union.macoms.la`, `newcrbpc.com` 등 도메인들이 
Polyfill 유지 관리자와 연관이 있는 것으로 드러났으며, 이는 이 사건이 더 큰 악의적은 캠페인의 일부일 가능성을 보여주고 있습니다.

## 현재는 어떻게 되었나요?
2024년 6월 27일, 보안 리서쳐들이 이 취약점에 대해서 Namecheap 이라는 도메인 회사에 보고 했고, Namecheap은 악성 polyfill 라이브러리가 웹사이트들에 inject 되지 않게 하기 위해 즉시 이 도메인을 차단했습니다. 추가적으로 CDN 서비스를 제공하는 Cloudflare와 같은 회사들은 polyfill 링크들을 다른 안전한 script로 미러링 되도록 조치를 하고, Google은 해당 도메인을 포함한 사이트들의 광고를 차단시켰습니다.

이러한 조치에도 불구하고 [Censys](https://censys.com/)는 2024년 7월 2일 기준 여전히 380,000개가 넘는 호스트들이 악성 polyfill 스크립트를 embedding 하고 있다고 발표했습니다.
이런 점은 앞으로 어떤 큰 피해가 있을지 예측할 수 없으며, 이러한 공격이 더 많이 일어날 수 있다는 것을 보여주고 있습니다.

## 이 사건을 통해 배워야할 점

### 아무도 믿어서는 안된다

아무리 인기가 많은 라이브러리라도 무작정 믿으면 안됩니다. 오픈 소스 라이브러이인 이상 누구던지 코드에 영향을 줄 수 있기 때문에, 외부 라이브러리를 사용할 때는 항상 조심히야합니다. Polyfill 라이브러라가 엄청나게 많은 사람들이 이용한 라이브러리였지만 이런 악성 스크립트를 심기 위한 도구가 된점으로 우리는 이것을 알 수 있습니다.

### CDN 보다는 NPM을 사용하자

CDN을 통해 스크립트를 임베딩 하는 방식은 빠르고 편리하지만, 이러한 공격에 취약할 수 있다는 것을 알수있습니다. CDN에서 제공하는 스크립트는 버전 컨트롤이 되지도 않고, CDN을 통해 받는 스크립트가 처음에는 문제가 없었지만 언제든지 내용물이 바뀔 수 있다는 것을 알아야합니다. 반면에 NPM을 사용해서 라이브러리르 받는다면 일단 특정 버전을 로컬에 다운받아서 사용하기 때문에, 내가 버전 변경을 하지 않는 이상 스크립트의 내용이 바뀔 염려는 하지 않아도 됩니다. 그리고 NPM 자체적으로 보안적인 심사를 하고 주기적으로 시큐리티 체크를 하기 때문에 CDN보다는 안전하다고 볼 수 있습니다.
다만 NPM을 사용하더라도 정확한 버전 정보를 지정해서 사용하는 것이 좋습니다. 무조건 최신버전으로 받는 다던지 하면 결국 내가 원하지 않았던 스크립트가 삽입될 우려가 있기 때문입니다.
